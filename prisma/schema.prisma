generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String        @id @default(uuid())
  name              String        @db.VarChar(255)
  email             String        @unique @db.VarChar(255)
  password          String        @db.VarChar(255)
  role              String        @db.VarChar(50)
  avatar_url        String?       @db.VarChar(255)
  created_at        DateTime      @default(now())
  updated_at        DateTime      @updatedAt

  createdTeams      Team[]        @relation("UserCreatedTeams")
  teamMemberships   TeamMember[]
  assignedTasks     Task[]        @relation("UserAssignedTasks")
  comments          Comments[]
  activityLogs      ActivityLog[]
  notifications     Notification[]
}

model Team {
  id                String        @id @default(uuid())
  name              String        @unique @db.VarChar(255)
  description       String?       @db.Text
  created_at        DateTime      @default(now())
  updated_at        DateTime      @updatedAt
  created_by_id     String

  createdBy         User          @relation("UserCreatedTeams", fields: [created_by_id], references: [id])
  members           TeamMember[]
  projects          Projects[]
}

model TeamMember {
  id                String        @id @default(uuid())
  team_id           String
  user_id           String
  role              String        @db.VarChar(50)
  joined_at         DateTime      @default(now())

  team              Team          @relation(fields: [team_id], references: [id])
  user              User          @relation(fields: [user_id], references: [id])

  @@unique([team_id, user_id])
}

model Projects {
  id                String        @id @default(uuid())
  team_id           String
  name              String        @db.VarChar(255)
  description       String?       @db.Text
  status            String        @db.VarChar(50)
  deadline          DateTime
  created_at        DateTime      @default(now())

  team              Team          @relation(fields: [team_id], references: [id])
  tasks             Task[]

  @@unique([team_id, name])
}

model Task {
  id                String        @id @default(uuid())
  project_id        String
  assign_to         String
  title             String        @db.VarChar(255)
  description       String?       @db.Text
  priority          String        @db.VarChar(50)
  status            String        @db.VarChar(50)
  due_date          DateTime
  created_at        DateTime      @default(now())
  updated_at        DateTime      @updatedAt

  project           Projects      @relation(fields: [project_id], references: [id])
  assignedUser      User          @relation("UserAssignedTasks", fields: [assign_to], references: [id])

  comment           Comments[]
}

model Comments {
  id                String        @id @default(uuid())
  task_id           String
  user_id           String
  content           String        @db.Text
  created_at        DateTime      @default(now())

  task              Task          @relation(fields: [task_id], references: [id])
  user              User          @relation(fields: [user_id], references: [id])
}

model ActivityLog {
  id                String        @id @default(uuid())
  user_id           String
  action            String        @db.VarChar(225)
  entity_id         String
  entity_type       String        @db.VarChar(50)
  created_at        DateTime      @default(now())

  user              User          @relation(fields: [user_id], references: [id])
}

model Notification {
  id                String        @id @default(uuid())
  user_id           String
  message           String        @db.Text
  is_read           Boolean       @default(false)
  created_at        DateTime      @default(now())

  user              User          @relation(fields: [user_id], references: [id])
}